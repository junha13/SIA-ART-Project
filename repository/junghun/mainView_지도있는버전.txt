<template>
  <div class="container-fluid py-5">

    <!-- 1. Header & Search Bar (강화된 디자인 및 지역 표시) -->
    <div class="px-3 mb-5">
      <div class="d-flex align-items-center mb-4">
        <div class="me-auto">
          <!-- 타이틀 중앙 정렬 및 굵기 강조 -->
          <h1 class="fs-4 fw-bolder mb-0 text-dark">예술을 찾는 사람들</h1>
          <p class="text-muted small mb-0 fw-semibold">Welcome, 예술가님!</p>
        </div>
        <!-- 아이콘 버튼 그룹 -->
        <div class="d-flex gap-2">
          <button class="btn btn-sm btn-light btn-icon rounded-circle" @click="router.push('/mypage')">
            <i class="fas fa-user fs-5"></i>
          </button>
          <button class="btn btn-sm btn-light btn-icon rounded-circle" @click="router.push('/favorite-products')">
            <i class="fas fa-heart fs-5"></i>
          </button>
        </div>
      </div>

      <!-- Search Input (디자인 강조) -->
      <div class="input-group shadow-md rounded-pill overflow-hidden bg-white mb-2">
        <input type="text" v-model="searchQuery" class="form-control border-0 ps-4" placeholder="작품, 작가, 동네를 검색해보세요!" />
        <button class="btn btn-primary btn-icon rounded-circle me-1 my-1 p-0" @click="performSearch" style="width: 38px; height: 38px;">
          <i class="fas fa-search"></i>
        </button>
      </div>

      <!-- 현재 위치 표시 배지 -->
      <div class="d-flex justify-content-start align-items-center mt-3">
        <span class="badge bg-light-dark text-dark fw-bold px-3 py-2 rounded-pill shadow-sm cursor-pointer" @click="router.push('/location-settings')">
            <i class="fas fa-map-marker-alt text-danger me-1"></i> {{ currentLocation }}
        </span>
      </div>
    </div>

    <!-- 2. Filters (시안 반영) -->
    <div class="d-flex flex-wrap gap-2 px-3 mb-6">
      <button
          v-for="filter in filters"
          :key="filter.key"
          class="btn btn-sm rounded-pill fw-bold"
          :class="activeFilter === filter.key ? 'btn-primary' : 'btn-outline-dark text-dark'"
          @click="activeFilter = filter.key">
        {{ filter.label }}
      </button>
    </div>

    <!-- 3. Map Section (높이 조정) -->
    <div class="card mb-6 mx-3 shadow-lg rounded-xl overflow-hidden">
      <div class="card-body p-0">
        <div id="mainMap" style="width: 100%; height: 280px;"></div>
      </div>
    </div>

    <!-- [NEW] 4. New Artworks Trend (새 작품 섹션 추가) -->
    <div class="px-3 mb-6">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fs-5 fw-bolder mb-0 text-dark">✨ 지금 막 올라온 새 작품</h3>
        <button class="btn btn-sm btn-light-secondary fw-bold" @click="router.push('/artworks')">
          <i class="fas fa-clock me-1"></i> 최신순
        </button>
      </div>

      <!-- 작품 리스트: 수평 스크롤 -->
      <div class="d-flex gap-4 overflow-auto pb-3 artwork-list-scroll">
        <div v-for="artwork in latestArtworks" :key="artwork.id" style="min-width: 160px;">
          <div
              class="card shadow-sm cursor-pointer rounded-lg overflow-hidden transition-300 hover-lift"
              @click="router.push(`/artwork/${artwork.id}`)"
          >
            <img :src="artwork.image" class="card-img-top" :alt="artwork.title" style="height: 180px; object-fit: cover;"/>
            <div class="card-body p-3">
              <h6 class="fw-bolder mb-1 text-truncate fs-6">{{ artwork.title }}</h6>
              <span class="badge bg-light-primary text-primary fw-bold mb-1">{{ artwork.price.toLocaleString() }}원</span>
              <p class="text-muted small mb-0 mt-1">by {{ artwork.artist }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- 5. Promotion Banner (시각적 강조) -->
    <div class="px-3 mb-6">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fs-5 fw-bolder mb-0 text-dark">놓치지 마세요!</h3>
      </div>
      <div class="card bg-primary shadow-lg p-5 rounded-xl cursor-pointer text-white transition-300 hover-lift" @click="router.push('/classes')">
        <div class="d-flex align-items-center">
          <i class="fas fa-fire fs-2 me-3"></i>
          <div class="flex-grow-1">
            <h4 class="fw-bolder mb-0 text-white">금주의 인기 강좌 TOP 3</h4>
            <p class="text-light mb-0 small fw-semibold">지금 바로 신청하고 10% 할인 받으세요!</p>
          </div>
          <i class="fas fa-chevron-right fs-4 ms-auto"></i>
        </div>
      </div>
    </div>


    <!-- 6. Artworks List (작가 추천 작품) -->
    <div class="px-3 mb-6">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fs-5 fw-bold mb-0">⭐ 작가님들이 추천하는 작품</h3>
        <button class="btn btn-sm btn-light-primary fw-bold" @click="router.push('/artworks')">전체 작품 보기</button>
      </div>

      <!-- 작품 리스트: 수평 스크롤로 변경하여 모바일 친화적으로 개선 -->
      <div class="d-flex gap-4 overflow-auto pb-3 artwork-list-scroll">
        <div v-for="artwork in featuredArtworks" :key="artwork.id" style="min-width: 160px;">
          <div
              class="card shadow-sm cursor-pointer rounded-lg overflow-hidden transition-300 hover-lift"
              @click="router.push(`/artwork/${artwork.id}`)"
          >
            <img :src="artwork.image" class="card-img-top" :alt="artwork.title" style="height: 180px; object-fit: cover;"/>
            <div class="card-body p-3">
              <h6 class="fw-bolder mb-1 text-truncate fs-6">{{ artwork.title }}</h6>
              <p class="text-muted small mb-1">by {{ artwork.artist }}</p>

              <!-- 위치 및 가격 -->
              <div class="d-flex justify-content-between align-items-center pt-1 border-top mt-1">
                <span class="text-primary fw-bolder fs-7">{{ artwork.price.toLocaleString() }}원</span>
                <small class="text-muted">
                  <i class="fas fa-heart text-danger me-1 fs-8"></i>{{ artwork.likes }}
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 7. Community & Class Promotion (기존 유지) -->
    <div class="px-3 mb-6">
      <div class="row g-4">
        <!-- 커뮤니티 (게시판) 바로가기 -->
        <div class="col-12 col-md-6">
          <div
              class="card bg-light-warning shadow-sm cursor-pointer h-100 p-5 rounded-lg transition-300 hover-lift"
              @click="router.push('/board')"
          >
            <div class="d-flex align-items-center">
              <i class="fas fa-comments fs-2 text-warning me-3"></i>
              <div>
                <h4 class="fw-bolder mb-0 text-dark">자유 게시판</h4>
                <p class="text-muted mb-0 small">작가와 대중의 소통 공간</p>
              </div>
              <i class="fas fa-chevron-right fs-4 text-warning ms-auto"></i>
            </div>
          </div>
        </div>
        <!-- 클래스 둘러보기 -->
        <div class="col-12 col-md-6">
          <div
              class="card bg-light-info shadow-sm cursor-pointer h-100 p-5 rounded-lg transition-300 hover-lift"
              @click="router.push('/classes')"
          >
            <div class="d-flex align-items-center">
              <i class="fas fa-chalkboard-teacher fs-2 text-info me-3"></i>
              <div>
                <h4 class="fw-bolder mb-0 text-dark">예술 클래스</h4>
                <p class="text-muted mb-0 small">숨겨진 재능을 발견하세요</p>
              </div>
              <i class="fas fa-chevron-right fs-4 text-info ms-auto"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 8. Floating Action Button (FAB) for Registration -->
    <button
        class="btn btn-primary btn-lg btn-icon shadow-lg position-fixed bottom-0 end-0 m-5 rounded-circle transition-300"
        style="width: 60px; height: 60px; font-size: 1.5rem; z-index: 1000;"
        @click="router.push('/product/register')"
    >
      <i class="fas fa-plus"></i>
    </button>
  </div>
</template>

<script setup>
import { ref, onMounted, computed } from 'vue'
import { useRouter } from 'vue-router'

const router = useRouter()
const map = ref(null)
const searchQuery = ref('')
const activeFilter = ref('artwork')
const currentLocation = ref('구로구 구로동') // 지역 표시 더미

const filters = [
  { key: 'artwork', label: '예술작품' },
  { key: 'studio', label: '작업실' },
  { key: 'gallery', label: '갤러리' },
  { key: 'etc', label: '더보기' },
]

// 지도에 표시할 작품/장소 더미 데이터 (가격 추가)
const allArtworks = [
  { id: 1, title: '고요한 아침의 빛', artist: '김준하', location: '구로구', lat: 37.5665, lng: 126.9780, likes: 6, price: 150000, image: 'https://placehold.co/200x180/5DADE2/fff?text=Art1' },
  { id: 2, title: '추상적 선율', artist: '이예술', location: '강남구', lat: 37.5700, lng: 126.9820, likes: 18, price: 420000, image: 'https://placehold.co/200x180/A3E4D7/000?text=Art2' },
  { id: 3, title: '바나나 코미디', artist: '마우리치오', location: '역삼동', lat: 37.5000, lng: 127.0363, likes: 42, price: 990000, image: 'https://placehold.co/200x180/F8C471/000?text=Comedian' },
  { id: 4, title: '새로운 추상', artist: '익명', location: '영등포구', lat: 37.5250, lng: 126.9000, likes: 18, price: 85000, image: 'https://placehold.co/200x180/EC7063/fff?text=Art4' },
  { id: 5, title: '도시의 그림자', artist: '박사진', location: '마포구', lat: 37.5500, lng: 126.9200, likes: 25, price: 250000, image: 'https://placehold.co/200x180/3699FF/fff?text=Photo' },
  { id: 6, title: '흙과 불의 춤', artist: '최도예', location: '종로구', lat: 37.5790, lng: 126.9749, likes: 12, price: 350000, image: 'https://placehold.co/200x180/FFA800/fff?text=Ceramic' },
]

// 최신 작품 (ID가 높은 순)
const latestArtworks = computed(() => {
  return [...allArtworks].sort((a, b) => b.id - a.id).slice(0, 3);
});

// 추천 작품 (좋아요 순)
const featuredArtworks = computed(() => {
  return [...allArtworks].sort((a, b) => b.likes - a.likes).slice(0, 5);
});


const initMap = () => {
  if (!window.naver) {
    console.error('Naver Maps SDK가 로드되지 않았습니다.')
    return
  }
  const mapOptions = {
    center: new window.naver.maps.LatLng(37.5665, 126.9780),
    zoom: 13,
    logoControl: false,
    mapDataControl: false,
    zoomControl: true
  }
  map.value = new window.naver.maps.Map('mainMap', mapOptions)

  // 마커 추가
  allArtworks.forEach(artwork => {
    new window.naver.maps.Marker({
      position: new window.naver.maps.LatLng(artwork.lat, artwork.lng),
      map: map.value,
      title: artwork.title
    })
  })
}

const performSearch = () => {
  console.log(`검색 실행: ${searchQuery.value} (필터: ${activeFilter.value})`)

  // 검색 시 작품 전체 목록 페이지로 이동하며 검색어 전달 (실제 구현 시)
  router.push({ path: '/artworks', query: { q: searchQuery.value, filter: activeFilter.value } })
}

onMounted(() => {
  // Naver Map SDK 로드 확인 후 초기화 (setTimeout 제거)
  if (window.naver) {
    initMap();
  } else {
    window.addEventListener('load', () => {
      if (window.naver) initMap();
    });
  }
})
</script>

<style scoped>
.cursor-pointer {
  cursor: pointer;
}
/* 카드 스타일 */
.card-img-top {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}
.rounded-xl {
  border-radius: 1rem !important;
}
.card {
  border-radius: 0.75rem !important;
  overflow: hidden;
  transition: transform 0.3s ease;
}
.rounded-pill {
  border-radius: 50rem !important;
}
.transition-300 {
  transition: all 0.3s ease;
}

/* FAB 버튼 애니메이션 */
.btn.position-fixed:hover {
  transform: scale(1.05);
}

/* 호버 시 카드 리프트 효과 */
.hover-lift:hover {
  transform: translateY(-5px);
  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}

/* 수평 스크롤 */
.artwork-list-scroll {
  white-space: nowrap;
  -webkit-overflow-scrolling: touch;
  overflow-x: auto;
}
.artwork-list-scroll::-webkit-scrollbar {
  display: none;
}
</style>
